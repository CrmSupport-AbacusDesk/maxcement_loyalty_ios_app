<!--
  Generated template for the SiteAddPage page.
  
  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-navbar>
    <ion-title *ngIf="siteform.id">{{'Edit Purchase Detail' | translate}}</ion-title>
    <ion-title *ngIf="!siteform.id">{{'Add Purchase Detail' | translate}}</ion-title>
  </ion-navbar>
</ion-header>

<ion-content padding>
  <div class="main-field padding16">
    <!-- <h3>{{ 'Basic information' | translate}} </h3> -->
    <div class="cs-form mb10">
      <form name="siteform"   (ngSubmit)="f.form.valid && submit() " #f="ngForm" >
        <div class="sprate-block">
          <ion-list>
            
            <!-- <ion-item class="cs-select" [ngClass]="{'error':f.submitted && site_location_id?.invalid}">
              <ion-label>{{'Site Address' | translate}}*</ion-label>
              <ion-select [(ngModel)]="siteform.site_location_id" name="site_location_id" #site_location_id="ngModel"  required>
                <ion-option [value]="row.id" (ionSelect)="getDealer(row.sales_zone)" *ngFor="let row of locations">{{row.address | titlecase}}, {{row.state | titlecase}}, {{row.district | titlecase}} <strong>{{row.site_owner_name | titlecase}} - {{row.site_owner_contact}}</strong></ion-option>
              </ion-select>
            </ion-item> -->
            
            <ion-item class="cs-select" [ngClass]="{'error':f.submitted && site_location_id?.invalid}">
              <ion-label>{{'Site Address' | translate}}*</ion-label>
              <ionic-selectable
              item-content 
              [(ngModel)]="siteform.site_location_id" 
              #site_location_id="ngModel"
              [items]="locations"
              name="site_location_id"
              itemValueField="address"
              itemTextField="address"
              [hasVirtualScroll]="true"
              (onChange)="getDealer($event)"
              [canSearch]="true" required>
            </ionic-selectable>
          </ion-item>
          <div *ngIf="f.submitted && site_location_id.invalid" class="invalid-feedback">
            <div *ngIf="site_location_id.errors.required">{{'Field is Required' | translate}}</div>
          </div>
          
          
          <ng-container *ngIf="userType == '2' || userType == '3'">
            <!-- <ion-item class="cs-select" [ngClass]="{'error':f.submitted && pc_id?.invalid}">
              <ion-label>{{'PC' | translate}}*</ion-label>
              <ion-select [(ngModel)]="siteform.pc_id" name="pc_id" #pc_id="ngModel" required>
                <ion-option [value]="row.id" *ngFor="let row of pcs">{{row.first_name | titlecase}} - {{row.mobile_no}}</ion-option>
              </ion-select>
            </ion-item> -->

            <ion-item class="cs-select" [ngClass]="{'error':f.submitted && pc_id?.invalid}">
              <ion-label>{{'PC' | translate}}*</ion-label>
              <ionic-selectable
              item-content 
              [(ngModel)]="siteform.pc_id" 
              #pc_id="ngModel"
              [items]="pcs"
              name="pc_id"
              itemValueField="first_name"
              itemTextField="first_name"
              [hasVirtualScroll]="true"
              [canSearch]="true" required>
            </ionic-selectable>
          </ion-item>
            <div *ngIf="f.submitted && pc_id.invalid" class="invalid-feedback">
              <div *ngIf="pc_id.errors.required">{{'Field is Required' | translate}}</div>
            </div>
          </ng-container>
          
          
          <!-- <ion-item class="cs-select" [ngClass]="{'error':f.submitted && dealer_id?.invalid}">
            <ion-label>{{'Dealer' | translate}}*</ion-label>
            <ion-select [(ngModel)]="siteform.dealer_id" name="dealer_id" #dealer_id="ngModel" required>
              <ion-option [value]="row.id" *ngFor="let row of dealers">{{row.company_name | titlecase}} - {{row.mobile_no}}</ion-option>
            </ion-select>
          </ion-item> -->

          <ion-item class="cs-select" [ngClass]="{'error':f.submitted && dealer_id?.invalid}" *ngIf="(userType == '1' || userType == '4') || (userType == '3')">
            <ion-label>{{'Channel Partner' | translate}}*</ion-label>
            <ionic-selectable
            item-content 
            [(ngModel)]="siteform.dealer_id" 
            #dealer_id="ngModel"
            [items]="dealers"
            name="dealer_id"
            itemValueField="company_name"
            itemTextField="company_name"
            [hasVirtualScroll]="true"
            [canSearch]="true" required>
          </ionic-selectable>
          <!-- (onChange)="getDealer(siteform.city.city_name)" -->

        </ion-item>
          <div class="invalid-feedback" *ngIf="f.submitted && dealer_id.invalid">
            <div *ngIf="dealer_id.errors.required">{{'Field is Required' | translate}}</div>
          </div>
          
          
          <ion-item class="cs-select" [ngClass]="{'error':f.submitted && product_id?.invalid}">
            <ion-label>{{'Product' | translate}}*</ion-label>
            <ion-select  [(ngModel)]="siteform.product_id" name="product_id" #product_id="ngModel" required>
              <ion-option [value]="row.id" *ngFor="let row of products">{{row.product_name}}</ion-option>
            </ion-select>
          </ion-item>
          <div *ngIf="f.submitted && product_id.invalid" class="invalid-feedback">
            <div *ngIf="product_id.errors.required">{{'Field is Required' | translate}}</div>
          </div>
          
          <ion-item class="cs-input" [ngClass]="{'error':f.submitted && qty?.invalid}">
            <ion-label floating>{{'Quantity' | translate}}*</ion-label>
            <ion-input type="tel" name="qty" [(ngModel)] = "siteform.qty" #qty="ngModel" (ngModelChange)="checkValue(siteform.qty)" required></ion-input>
          </ion-item>
          <div *ngIf="f.submitted && qty.invalid" class="invalid-feedback">
            <div *ngIf="qty.errors.required">{{'Field is Required' | translate}}</div>
          </div>
        </ion-list>
      </div>
      <div class="pt16 pb16">
        <button type="submit" *ngIf="siteform.id"  ion-button full [disabled]="saveFlag == true">{{ 'Update' | translate }}</button>
        <button type="submit" *ngIf="!siteform.id"  ion-button full [disabled]="saveFlag == true">{{ 'Save' | translate }}</button>
      </div>
    </form>
  </div>
</div>
</ion-content>
